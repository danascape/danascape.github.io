<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Android Device Tree Bringup" /><meta name="author" content="Saalim Quadri" /><meta property="og:locale" content="en" /><meta name="description" content="Learn how to bring-up a device tree for your device so you can get started with building your favourite custom ROM!" /><meta property="og:description" content="Learn how to bring-up a device tree for your device so you can get started with building your favourite custom ROM!" /><link rel="canonical" href="https://danascape.github.io/posts/Android-Device-Tree-Bringup/" /><meta property="og:url" content="https://danascape.github.io/posts/Android-Device-Tree-Bringup/" /><meta property="og:site_name" content="squadri" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-04T00:00:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Android Device Tree Bringup" /><meta name="twitter:site" content="@danascape" /><meta name="twitter:creator" content="@danascape" /><meta name="google-site-verification" content="G-WDDV94BTDD" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Saalim Quadri","url":"https://x.com/danascape"},"dateModified":"2021-10-04T00:00:00+05:30","datePublished":"2021-10-04T00:00:00+05:30","description":"Learn how to bring-up a device tree for your device so you can get started with building your favourite custom ROM!","headline":"Android Device Tree Bringup","mainEntityOfPage":{"@type":"WebPage","@id":"https://danascape.github.io/posts/Android-Device-Tree-Bringup/"},"url":"https://danascape.github.io/posts/Android-Device-Tree-Bringup/"}</script><title>Android Device Tree Bringup | squadri</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="squadri"><meta name="application-name" content="squadri"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WDDV94BTDD"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-WDDV94BTDD'); }); </script> <script src="/assets/js/pwa-popup.js" defer></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/my-avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">squadri</a><p class="site-subtitle fst-italic mb-0">Kernels and AOSP.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/danascape" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/danascape" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['saalim.priv','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Android Device Tree Bringup</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Android Device Tree Bringup</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1633285800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 4, 2021 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://x.com/danascape">Saalim Quadri</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3194 words" > <em>17 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Android Device Tree Bringup</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Android Device Tree Bringup</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>Learn how to bring-up a device tree for your device so you can get started with building your favourite custom ROM!</p><p><a href="/assets/images/posts/Android-Device-Tree-Bringup/devicetree_bringup_title.jpg" class="popup img-link shimmer"><img src="/assets/images/posts/Android-Device-Tree-Bringup/devicetree_bringup_title.jpg" alt="" loading="lazy"></a></p><p>Some of you guys might be wondering how people create your favorite custom ROMs like LineageOS, PixelExperience, HavocOS, and so on. I’m here to guide you about the basics of a device tree and how to do a scratch bring-up of your own.</p><p>This article is a follow-up to my earlier article, <a href="https://blog.realogs.in/getting-started-with-aosp/">Introduction to AOSP</a> in which we discussed the fundamentals of and how to join the Android Open Source Project.</p><h3 id="prerequisites"><span class="me-2">Prerequisites</span><a href="#prerequisites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Certain requirements are to be met before starting the bringup.</p><ol><li><p>Ability to understand basic editing/writing of files and text, familiarity with the command line interface and some basic git knowledge.</p><li><p>A machine powerful enough to build Android – you can check the basic requirements <a href="https://source.android.com/setup/build/requirements">here</a>.</p><li><p>Possess a fundamental understanding of the Android Open Source Project’s build system, commands, and other aspects. You can read more about it <a href="https://blog.realogs.in/getting-started-with-aosp/">here</a>.</p></ol><h3 id="note"><span class="me-2">Note:</span><a href="#note" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>This guide only applies to devices launched with Project Treble enabled (Android Oreo 8.0+).<li>The device tree I’m using as a reference is a Qualcomm SDM632 (MSM8953) based tree, launched with Android 8.1.<li>The guide uses LineageOS as the Android ROM Build System. Each ROM can have their own unique build system which might differ.<li>The partition table of devices might differ from the device taken as an example below.</ul><h2 id="understanding-basic-structure"><span class="me-2">Understanding Basic Structure</span><a href="#understanding-basic-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Android device trees are certain bits and bytes of <code class="language-plaintext highlighter-rouge">Makefile</code> code that allows the Android build system to recognize the specifications of the target device, and what all is to be built along with it.</p><p>After reading this guide, you will be able to bringup a prebuilt vendor based device tree (will explain what that means in a while).</p><p>To start, let’s look at a basic bringup: <a href="/assets/images/posts/Android-Device-Tree-Bringup/x01ad-dt-home.jpg" class="popup img-link shimmer"><img src="/assets/images/posts/Android-Device-Tree-Bringup/x01ad-dt-home.jpg" alt="" loading="lazy"></a></p><p>These certain files and folders are ones we come across in every other device tree.</p><p>Let’s break down the important ones:</p><ul><li><strong>Android.mk</strong>: This is the most basic <code class="language-plaintext highlighter-rouge">Makefile</code> definition for any path to be included in the Android build system. This <code class="language-plaintext highlighter-rouge">Makefile</code> calls for all other <code class="language-plaintext highlighter-rouge">Makefiles</code> present in the all the directories and subdirectories of the device tree. The basic use of this specific <code class="language-plaintext highlighter-rouge">Makefile</code> is to guard the device tree <code class="language-plaintext highlighter-rouge">Makefiles</code> when not building for our target device.<li><strong>BoardConfig.mk</strong>: This contains the Board (SoC/Chipset) specific definition, such as the architecture (arm, arm64, x86, so on), the required build flags and the kernel build flags. These flags aid the build process.<li><strong>aosp_&lt;<em>device-name</em>&gt;.mk</strong>: This is a common <code class="language-plaintext highlighter-rouge">Makefile</code> found in most AOSP trees. This specific <code class="language-plaintext highlighter-rouge">Makefile</code> defines device name, manufacturer and build product details and is also used to call <strong>device.mk</strong> described below.<li><strong>AndroidProducts.mk</strong>: This <code class="language-plaintext highlighter-rouge">Makefile</code> includes the device product <code class="language-plaintext highlighter-rouge">Makefiles</code>, i.e. the aforementioned <strong>aosp_&lt;<em>device-name</em>&gt;.mk</strong> on <code class="language-plaintext highlighter-rouge">lunch</code> (term used to initialise device trees for build). This <code class="language-plaintext highlighter-rouge">Makefile</code> also defines the lunch target (Android 10+).<li><strong>device.mk</strong>: This <code class="language-plaintext highlighter-rouge">Makefile</code> contains all the build targets and copy specifications such as audio configs, feature configs, and so on. If you want a certain package to be built inline with Android ROM builds, this where you’d want to define it. The vendor tree <code class="language-plaintext highlighter-rouge">Makefiles</code> are also called from here.<li><strong>vendorsetup.sh</strong>: This shell script was superceded by <code class="language-plaintext highlighter-rouge">AndroidProducts.mk</code> after Android 10.</ul><h3 id="note-1"><span class="me-2">Note:</span><a href="#note-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Not all the contents of a device tree are needed to be brought up from scratch since only certain files differ as per device and chipset, so I mentioned only the required ones.</ul><h2 id="starting-the-bringup"><span class="me-2">Starting the Bringup</span><a href="#starting-the-bringup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we know the basic structure of an android device tree, let’s start our bringup.</p><ul><li>A prebuilt vendor based device tree is the one which uses device OEM vendor to run ROM. Basically while flashing ROMs based on this device tree you do not need to wipe vendor.<li>You’ll need to figure out the codename of the device by looking at the <strong>build number</strong> or <strong>reading the build.prop</strong> or <strong>checking the stock rom dump</strong>. This is not important and you can use any codename for your device.</ul><p>P/S : My friend chose amogus as his device’s codename.</p><ul><li>You’ll also need to create a directory where your device tree will be placed and called by Android Build System.</ul><p>According to Google devices, you can create this directory in <code class="language-plaintext highlighter-rouge">device/device-implementer/device-name/</code>, where the device implementer is the device manufacturer, such as <code class="language-plaintext highlighter-rouge">asus</code>, <code class="language-plaintext highlighter-rouge">google</code>, <code class="language-plaintext highlighter-rouge">oneplus</code>, <code class="language-plaintext highlighter-rouge">oppo</code>, <code class="language-plaintext highlighter-rouge">realme</code>, <code class="language-plaintext highlighter-rouge">xiaomi</code>, and so on.</p><h2 id="starting-with-androidmk"><span class="me-2">Starting with Android.mk</span><a href="#starting-with-androidmk" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>It must begin by defining the <code class="language-plaintext highlighter-rouge">LOCAL_PATH</code> variable such that android build system can call the makefile:<pre><code class="language-Makefile">LOCAL_PATH := $(call my-dir)
</code></pre><li>Now we would need to guard our device <code class="language-plaintext highlighter-rouge">Makefiles</code> to only be called when it’s mentioned in <code class="language-plaintext highlighter-rouge">lunch</code>:<pre><code class="language-Makefile">ifeq ($(TARGET_DEVICE),&lt;device-codename&gt;)
endif
</code></pre><p>This means that it will start including the device tree <strong>only</strong> if the <code class="language-plaintext highlighter-rouge">TARGET_DEVICE</code> variable is set to your device.</p></ul><p>In order for our Android <code class="language-plaintext highlighter-rouge">Makefile</code> to include all other makefiles in the directory or sub directories, you can do it as:</p><pre><code class="language-Makefile">ifeq ($(TARGET_DEVICE),&lt;device-codename&gt;)

include $(call all-makefiles-under,$(LOCAL_PATH))

endif
</code></pre><p>In my case, the device’s codename is X01AD, so in the end it should look like this:</p><pre><code class="language-Makefile">LOCAL_PATH := $(call my-dir)

ifeq ($(TARGET_DEVICE),X01AD)

include $(call all-makefiles-under,$(LOCAL_PATH))

endif
</code></pre><p>This concludes the basic <code class="language-plaintext highlighter-rouge">Android.mk</code> structure.</p><h2 id="moving-on-to-boardconfigmk"><span class="me-2">Moving on to BoardConfig.mk</span><a href="#moving-on-to-boardconfigmk" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>As the name suggests, it includes board specific variables, such as chipset or device specific feature flags.<li>There’s a certain set of flags that are important for all devices, such as the architecture, command line and partition information.</ul><p>Since I have an <code class="language-plaintext highlighter-rouge">arm64</code> based Qualcomm device, I can start with setting up base architecture as such:</p><pre><code class="language-Makefile">TARGET_ARCH := arm64
TARGET_ARCH_VARIANT := armv8-a
TARGET_CPU_ABI := arm64-v8a
TARGET_CPU_ABI2 :=
TARGET_CPU_VARIANT := generic
</code></pre><p>and a fallback secondary architecture as:</p><pre><code class="language-Makefile">TARGET_2ND_ARCH := arm
TARGET_2ND_ARCH_VARIANT := armv8-a
TARGET_2ND_CPU_ABI := armeabi-v7a
TARGET_2ND_CPU_ABI2 := armeabi
TARGET_2ND_CPU_VARIANT := generic
</code></pre><p>The Android build server generates build artifacts and VNDK snapshot files using the following build parameters. You can read more about them <a href="https://developer.android.com/ndk/guides/abis#cmake">here</a> and <a href="https://source.android.com/docs/core/architecture/vndk/snapshot-generate">here</a>.</p><p>For those who have an <code class="language-plaintext highlighter-rouge">arm</code> based device, you can just set:</p><pre><code class="language-Makefile">TARGET_ARCH := arm
TARGET_ARCH_VARIANT := armv8-a
TARGET_CPU_ABI := armeabi-v7a
TARGET_CPU_ABI2 := armeabi
TARGET_CPU_VARIANT := generic
</code></pre><p>These are global variables and can be used for all devices. Developers might change CPU variants according to chipsets but that’s not necessary.</p><ul><li>Now, you need to define your device bootloader variables as such:<pre><code class="language-Makefile">TARGET_BOOTLOADER_BOARD_NAME := #(Based on your device)
TARGET_NO_BOOTLOADER := true #(For source to not build bootloader)
</code></pre><p>For my device it looks like this:</p></ul><h2 id="moving-on-to-the-kernel-build-system"><span class="me-2">Moving on to the kernel build system</span><a href="#moving-on-to-the-kernel-build-system" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We will set up the required flags as per the LineageOS build system.</p><p>In Android, Qualcomm (QCOM) and Mediatek (MTK) chipsets set some kernel parameters which are picked up by their Operating System (the preloaded stock ROM). They are set in device tree source as a kernel cmdline parameter this way:</p><pre><code class="language-Makefile"># You can have additional values to the same flag by using the append symbol ("+=") instead of initialise symbol (":=")

BOARD_KERNEL_CMDLINE := #(This is initialised)
BOARD_KERNEL_CMDLINE +=
</code></pre><p>You can obtain your device cmdline by unpacking your stock firmware bootimage using mkbootimg tools from <a href="https://github.com/LineageOS/android_system_core/tree/lineage-17.1/mkbootimg">here</a>. During unpack you will obtain an output with kernel cmdline which looks like:</p><p>` cmd_line=’console=ttyMSM0,115200n8 androidboot.hardware=qcom androidboot.console=ttyMSM0 androidboot.memcg=1 lpm_levels.sleep_disabled=1 video=vfb:640x400,bpp=32,memsize=3072000 msm_rtb.filter=0x237 service_locator.enable=1 swiotlb=1 androidboot.usbcontroller=a600000.dwc3 earlycon=msm_geni_serial,0x880000 loop.max_part=7’ `</p><p>So after setting up your kernel cmdline you need to set some base kernel flags which matches your stock bootimage in order for it to boot up your device:</p><pre><code class="language-Makefile">BOARD_KERNEL_BASE :=
BOARD_KERNEL_PAGESIZE :=
BOARD_KERNEL_TAGS_OFFSET :=
BOARD_RAMDISK_OFFSET :=
</code></pre><p>They can be obtained from mkbootimg tools during unpack of your stock firmware bootimage. Read more about them <a href="https://source.android.com/docs/core/architecture/bootloader/boot-image-header#implementing-versioning">here</a>.</p><p>After setting the flags, we want our kernel source to get built; as per the LineageOS build system we can either build our kernel from source or use prebuilt binaries as per our convenience. Usage of a source built kernel looks like this:</p><pre><code class="language-Makefile">TARGET_KERNEL_CONFIG := #(Kernel Config name to be picked up as per architecture from kernel-source-path/arch/&lt;device-architecture&gt;/configs/)

TARGET_KERNEL_SOURCE := #(Your kernel source path from root of Android source)
</code></pre><p>After setting up your flags it should look like this:</p><pre><code class="language-Makefile">BOARD_KERNEL_CMDLINE := console=ttyMSM0,115200,n8 androidboot.hardware=qcom
BOARD_KERNEL_CMDLINE += androidboot.console=ttyMSM0
BOARD_KERNEL_CMDLINE += msm_rtb.filter=0x237 ehci-hcd.park=3
BOARD_KERNEL_CMDLINE += lpm_levels.sleep_disabled=1
BOARD_KERNEL_CMDLINE += androidboot.bootdevice=7824900.sdhci
BOARD_KERNEL_CMDLINE += earlycon=msm_serial_dm,0x78af000
BOARD_KERNEL_CMDLINE += firmware_class.path=/vendor/firmware_mnt/image
BOARD_KERNEL_CMDLINE += androidboot.usbconfigfs=true
BOARD_KERNEL_CMDLINE += loop.max_part=7
BOARD_KERNEL_CMDLINE += androidboot.selinux=permissive

BOARD_KERNEL_BASE := 0x80000000
BOARD_KERNEL_PAGESIZE :=  2048
BOARD_KERNEL_IMAGE_NAME := Image.gz-dtb
BOARD_KERNEL_TAGS_OFFSET := 0x00000100

BOARD_RAMDISK_OFFSET := 0x01000000

TARGET_KERNEL_CONFIG := X01AD_defconfig
TARGET_KERNEL_SOURCE := kernel/asus/X01AD
</code></pre><p>A configuration with prebuilt kernel should look like this:</p><pre><code class="language-Makefile">BOARD_KERNEL_CMDLINE := console=ttyMSM0,115200,n8 androidboot.hardware=qcom
BOARD_KERNEL_CMDLINE += androidboot.console=ttyMSM0
BOARD_KERNEL_CMDLINE += msm_rtb.filter=0x237 ehci-hcd.park=3
BOARD_KERNEL_CMDLINE += lpm_levels.sleep_disabled=1
BOARD_KERNEL_CMDLINE += androidboot.bootdevice=7824900.sdhci
BOARD_KERNEL_CMDLINE += earlycon=msm_serial_dm,0x78af000
BOARD_KERNEL_CMDLINE += firmware_class.path=/vendor/firmware_mnt/image
BOARD_KERNEL_CMDLINE += androidboot.usbconfigfs=true
BOARD_KERNEL_CMDLINE += loop.max_part=7
BOARD_KERNEL_CMDLINE += androidboot.selinux=permissive

BOARD_KERNEL_BASE := 0x80000000
BOARD_KERNEL_PAGESIZE :=  2048
BOARD_KERNEL_IMAGE_NAME := Image.gz-dtb
BOARD_KERNEL_TAGS_OFFSET := 0x00000100

BOARD_RAMDISK_OFFSET := 0x01000000

TARGET_PREBUILT_KERNEL := device/asus/X01AD-kernel/Image.gz-dtb
</code></pre><p>Source will pick up these offset flags for use in <code class="language-plaintext highlighter-rouge">mkboot</code> arguments, so there’s no need to set them again in the <code class="language-plaintext highlighter-rouge">BoardConfig</code>.</p><h2 id="moving-on-to-partition-flags"><span class="me-2">Moving on to partition flags</span><a href="#moving-on-to-partition-flags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Different devices have different partition sizes and names. I will using my QCOM device as a reference, but it might be different for your device.</p><p>Basically, a built Android OS flashable ZIP flashes over the boot, cache, recovery and system partitions.</p><p>After Android 8.0, a new partition named vendor was introduced (Project Treble).</p><p>#(Comment need to do something here and redirect over project treble)</p><p>After more Android releases more partitions were introduced, so as per Android 11 convention, the partition used by Android are <code class="language-plaintext highlighter-rouge">boot</code>, <code class="language-plaintext highlighter-rouge">cache</code>, <code class="language-plaintext highlighter-rouge">odm</code>, <code class="language-plaintext highlighter-rouge">product</code>, <code class="language-plaintext highlighter-rouge">recovery</code>, <code class="language-plaintext highlighter-rouge">system</code>, <code class="language-plaintext highlighter-rouge">system_ext</code>, <code class="language-plaintext highlighter-rouge">vendor</code>. These are basic names and may change (like <code class="language-plaintext highlighter-rouge">system_a</code>, <code class="language-plaintext highlighter-rouge">system_b</code> for A/B devices).</p><p>You can check path of your partitions using:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">ls</span> <span class="nt">-l</span> /dev/block/bootdevice/by-name
</pre></table></code></div></div><p>This path works for most of generic devices and may change.</p><p>Now in order to obtain partition sizes</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>blockdev <span class="nt">--getsize64</span> &lt;partition-path&gt;
</pre></table></code></div></div><p>Example:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>blockdev <span class="nt">--getsize64</span> /dev/block/bootdevice/by-name/system
</pre></table></code></div></div><p>This will give output of your partition sizes in bytes, you can directly set it as a flag variable so no need to convert the values.</p><p>For prebuilt vendor based device trees, you can just fetch partition sizes for <code class="language-plaintext highlighter-rouge">boot</code>, <code class="language-plaintext highlighter-rouge">cache</code>, <code class="language-plaintext highlighter-rouge">odm</code>, <code class="language-plaintext highlighter-rouge">product</code>, <code class="language-plaintext highlighter-rouge">recovery</code>, <code class="language-plaintext highlighter-rouge">system</code>, <code class="language-plaintext highlighter-rouge">system_ext</code>, and <code class="language-plaintext highlighter-rouge">userdata</code> (<code class="language-plaintext highlighter-rouge">/data</code>).</p><p>No need to worry if you do not have a certain partition – this list is tentative.</p><p>After obtaining the partition sizes to set them as flags you can do this:</p><pre><code class="language-Makefile">BOARD_&lt;partition-name-in-capital&gt;IMAGE_PARTITION_SIZE :=
</code></pre><p>Example:</p><pre><code class="language-Makefile">BOARD_SYSTEMIMAGE_PARTITION_SIZE := 4294967296
</code></pre><p>After that you need to set partition filesystem type, this can be <code class="language-plaintext highlighter-rouge">f2fs</code>, <code class="language-plaintext highlighter-rouge">ext2</code>, <code class="language-plaintext highlighter-rouge">ext3</code>, <code class="language-plaintext highlighter-rouge">ext4</code>, and so on. You can find your partition filesystem type in your device <code class="language-plaintext highlighter-rouge">fstab</code> located in <code class="language-plaintext highlighter-rouge">/vendor/etc/fstab.qcom</code></p><p>To set partition file system type you can do this:</p><pre><code class="language-Makefile">BOARD_&lt;partition-name-in-caps&gt;IMAGE_FILE_SYSTEM_TYPE :=
</code></pre><p>Setting file system time for partitions is not important as the Android build system will pick default types if you do not set them, but the partition <code class="language-plaintext highlighter-rouge">userdata</code> is an exception where it is absolutely necessary to defined the filesystem type and the flags for doing so are different, namely:</p><pre><code class="language-Makefile">TARGET_USERIMAGES_USE_EXT4 := true
# or
TARGET_USERIMAGES_USE_F2FS:= true
</code></pre><p>After setting up your partition flags and file system types, it should look like this:</p><pre><code class="language-Makefile"># Partitions - Boot
BOARD_BOOTIMAGE_PARTITION_SIZE := 67108864
BOARD_FLASH_BLOCK_SIZE := 131072 # (BOARD_KERNEL_PAGESIZE * 64)

# Partitions - Cache
BOARD_CACHEIMAGE_PARTITION_SIZE := 367001600
BOARD_CACHEIMAGE_FILE_SYSTEM_TYPE := ext4

# Partitions - Recovery
BOARD_RECOVERYIMAGE_PARTITION_SIZE := 67108864

# Partitions - System
BOARD_SYSTEMIMAGE_PARTITION_SIZE := 4294967296

# Partitions - Userdata
BOARD_USERDATAIMAGE_PARTITION_SIZE := 55423516160
</code></pre><p><strong>Note: keep in mind that these are different as per devices.</strong></p><h2 id="moving-on-to-device-platform"><span class="me-2">Moving on to Device Platform</span><a href="#moving-on-to-device-platform" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>It can be set this way:</p><pre><code class="language-Makefile">TARGET_BOARD_PLATFORM := 
</code></pre><p>it can be <code class="language-plaintext highlighter-rouge">msm8937</code>, <code class="language-plaintext highlighter-rouge">msm8953</code>, <code class="language-plaintext highlighter-rouge">sdm660</code>, and so on. It is to be set according to your device. It is a CAF variable which is picked up by the LineageOS build system in order to build chipset specific HALs (We will learn about this later).</p><h2 id="moving-on-to-recovery-fstab"><span class="me-2">Moving on to Recovery fstab</span><a href="#moving-on-to-recovery-fstab" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Won’t explain much about it since you can read it <a href="https://source.android.com/docs/core/ota/nonab/device_code#partition-map">here</a>.</p><p>So after reading the above thread, you can take your device <code class="language-plaintext highlighter-rouge">fstab</code> which can be found in <code class="language-plaintext highlighter-rouge">/vendor/etc/fstab.qcom</code> (<code class="language-plaintext highlighter-rouge">fstab.qcom</code> in my case, it can be anything else for other chipset devices, <code class="language-plaintext highlighter-rouge">fstab.qcom</code> is picked up by our bootloader) and set the flag pointing out it in device tree.</p><pre><code class="language-Makefile">TARGET_RECOVERY_FSTAB := fstab-path-in-device-source/fstab.qcom
</code></pre><p>Example:</p><pre><code class="language-Makefile">TARGET_RECOVERY_FSTAB := $(DEVICE_PATH)/rootdir/etc/fstab.qcom
</code></pre><h2 id="generating-vndk-snapshots"><span class="me-2">Generating VNDK Snapshots</span><a href="#generating-vndk-snapshots" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Vendor Native Development Kit, check it out in brief <a href="https://source.android.com/docs/core/architecture/vndk/snapshot-generate">here</a>.</p><p>You can set <code class="language-plaintext highlighter-rouge">BoardConfig</code> flags as read above and set the VNDK version as per your desired vendor.</p><p>As a default behaviour, source sets <code class="language-plaintext highlighter-rouge">BOARD_VNDK_VERSION := current</code>, here current implies vndk version of current android source (like <code class="language-plaintext highlighter-rouge">29</code> for Q, <code class="language-plaintext highlighter-rouge">30</code> for R).</p><p>Suppose you are trying to build Android Q for a vendor based on Android 9 – you can then set <code class="language-plaintext highlighter-rouge">PRODUCT_TARGET_VNDK_VERSION :=</code> value as per your vendor (28 for Pie).</p><p>You can also include additional VNDK snapshots for your vendor, like if you want Oreo vndk snapshots as well as Pie, you can set <code class="language-plaintext highlighter-rouge">PRODUCT_EXTRA_VNDK_VERSIONS :=</code> value as you desire.</p><h2 id="sepolicy--selinux"><span class="me-2">SEPolicy / SELinux</span><a href="#sepolicy--selinux" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Setting SEPolicy is not very important for prebuilt vendor based device trees as most of selinux rules are defined in vendor sepolicy.</p><p>You can read about SEPolicy <a href="https://source.android.com/security/selinux">here</a>.</p><p>Your device will proceed onto boot animation on SELinux due to the same reason as listed above, so you can just fixup the remaining denials by setting up SELinux on the system side.</p><p>This can be done by including QCOM sepolicy (Board specific since this guide is for QCOM boards).</p><pre><code class="language-Makefile">BOARD_PLAT_PRIVATE_SEPOLICY_DIR += device/qcom/sepolicy/private
BOARD_PLAT_PUBLIC_SEPOLICY_DIR += device/qcom/sepolicy/public
</code></pre><p>This is global and can be used by any device, <code class="language-plaintext highlighter-rouge">BOARD_PLAT</code> implies SEPolicy will be updated in system side.</p><p>Similarly <code class="language-plaintext highlighter-rouge">BOARD_PRODUCT</code> for product side.</p><ul><li>Calling out vendor <code class="language-plaintext highlighter-rouge">BoardConfig</code> <code class="language-plaintext highlighter-rouge">Makefile</code> Include your vendor device makefile as:<pre><code class="language-Makefile"># Inherit from the proprietary version
include vendor/device-implementer/device-name/BoardConfigVendor.mk
</code></pre><p>Example:-</p><pre><code class="language-Makefile"># Inherit from the proprietary version
include vendor/asus/X01AD/BoardConfigVendor.mk
</code></pre><p>We will learn more about vendor a bit later.</p></ul><h2 id="starting-out-with-device-product"><span class="me-2">Starting out with device product</span><a href="#starting-out-with-device-product" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Source calls device product which relatively calls other <code class="language-plaintext highlighter-rouge">Makefiles</code> present in the device tree.<li>By default when a product <code class="language-plaintext highlighter-rouge">Makefile</code> is called, it also includes the <code class="language-plaintext highlighter-rouge">BoardConfig</code> <code class="language-plaintext highlighter-rouge">Makefile</code>, so we don’t need to include it.<li>A device product <code class="language-plaintext highlighter-rouge">Makefile</code> looks like <code class="language-plaintext highlighter-rouge">ROM-name_device-name.mk</code>, for example <code class="language-plaintext highlighter-rouge">lineage_X01AD.mk</code>. This can change accordingly for other ROMs.<li>In the device product <code class="language-plaintext highlighter-rouge">Makefile</code> you can configure if you want 64/32-bit apps to run on your system, whether your device will have telephony (radio in basic words) or if it is wifi-only, and so on. These <code class="language-plaintext highlighter-rouge">Makefiles</code> are found in <code class="language-plaintext highlighter-rouge">build/target/product</code> in the source directory.</ul><p>According to basic <code class="language-plaintext highlighter-rouge">Makefile</code> syntax rules we can call another <code class="language-plaintext highlighter-rouge">Makefile</code> by using <code class="language-plaintext highlighter-rouge">$(call inherit-product, &lt;makefile-path&gt;)</code>.</p><p>In Android source, there is a variable which sets path for <code class="language-plaintext highlighter-rouge">build/target</code>, i.e <code class="language-plaintext highlighter-rouge">$(SRC_TARGET_DIR)</code>, So in order to call a <code class="language-plaintext highlighter-rouge">Makefile</code> from target product we can just use <code class="language-plaintext highlighter-rouge">$(SRC_TARGET_DIR)/product/&lt;makefile-name&gt;</code>.</p><p>You can read these <code class="language-plaintext highlighter-rouge">Makefiles</code> for more information.</p><ul><li>Device product <code class="language-plaintext highlighter-rouge">Makefile</code> is also used to call the ROM specific common <code class="language-plaintext highlighter-rouge">Makefile</code> (mainly ROM specific features). You can find these <code class="language-plaintext highlighter-rouge">Makefiles</code> in <code class="language-plaintext highlighter-rouge">vendor/ROM-name/config/</code> which will be <code class="language-plaintext highlighter-rouge">vendor/lineage/config</code> in our case.</ul><p>We can call it this way:</p><pre><code class="language-Makefile">$(call inherit-product, vendor/lineage/config/common_full_phone.mk)
</code></pre><ul><li>In the end, we need to set device name and product name which should match our ROM-name.</ul><p>Example:</p><pre><code class="language-Makefile"># Device identifiers.
PRODUCT_NAME := lineage_X01AD
PRODUCT_DEVICE := X01AD
PRODUCT_MANUFACTURER := asus
PRODUCT_BRAND := asus
PRODUCT_MODEL := ASUS_X01AD
</code></pre><p>These are basic device identifiers and I don’t think further explanation is required since they’re fairly self-explanatory.</p><h2 id="calling-our-device-product"><span class="me-2">Calling our device product</span><a href="#calling-our-device-product" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Since Android Q, we need to create <code class="language-plaintext highlighter-rouge">AndroidProducts.mk</code> in order to call our device product makefile.</ul><p>This can be done this way:</p><pre><code class="language-Makefile">PRODUCT_MAKEFILES := \
    $(LOCAL_DIR)/ROM-name_device-name.mk
</code></pre><p>Example:</p><pre><code class="language-Makefile">PRODUCT_MAKEFILES := \
    $(LOCAL_DIR)/lineage_X01AD.mk
</code></pre><p>You can find a reference commit to set device product <a href="https://github.com/danascape/android_device_asus_X01AD/commit/666612c5b81e514925ebed4b63954313e373804a">here</a>.</p><h2 id="last-but-not-the-least"><span class="me-2">Last but not the least</span><a href="#last-but-not-the-least" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>You need to call this <code class="language-plaintext highlighter-rouge">Makefile</code> from device product <code class="language-plaintext highlighter-rouge">Makefile</code>:<pre><code class="language-Makefile">$(call inherit-product, device/device-implementer/device-name/device.mk)
</code></pre><p>Example:</p><pre><code class="language-Makefile"># Inherit from X01AD device
$(call inherit-product, device/asus/X01AD/device.mk)
</code></pre><li>We create a device makefile in our device tree which defines package names or device dimensions or screen density.</ul><p>Some basic flags are lister here:</p><pre><code class="language-Makefile"># Boot animation
TARGET_SCREEN_HEIGHT :=
TARGET_SCREEN_WIDTH :=

# Device uses high-density artwork where available
PRODUCT_AAPT_CONFIG :=
PRODUCT_AAPT_PREF_CONFIG :=
</code></pre><ul><li>You can also inherit your device proprietary system files (will explain a bit later) as follows:<pre><code class="language-Makefile">$(call inherit-product-if-exists, vendor/device-implementer/device-name/device-name-vendor.mk)
</code></pre></ul><h2 id="customizing-the-build-with-overlays"><span class="me-2">Customizing the build with overlays</span><a href="#customizing-the-build-with-overlays" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Android build system uses overlays to customize or override resource values specifically for a product.<li>To use overlays, modify the project device <code class="language-plaintext highlighter-rouge">Makefile</code> to set <code class="language-plaintext highlighter-rouge">PRODUCT_PACKAGE_OVERLAYS</code> to a path relative to your top-level directory.</ul><p>You can do it as follows:</p><pre><code class="language-Makefile">PRODUCT_PACKAGE_OVERLAYS := device/device-implementer/device-name/overlay
</code></pre><ul><li>Default overlays can be found by extracting frameworks-res from your stock device dump using <code class="language-plaintext highlighter-rouge">apktool</code> (not in scope of this guide).<li>Note that overlays are not important to boot the ROM on your device. They are used to overwrite certain properties or values over source to fixup certain bugs related to dimensions or similar.<li>Read more about overlays and how they work <a href="https://source.android.com/devices/architecture/rros">here</a>.</ul><h2 id="setting-up-device-vendor"><span class="me-2">Setting up device vendor</span><a href="#setting-up-device-vendor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>There are certain libraries and APKs which are not source buildable (or proprietary) but are important for devices to have in order to gain some features or functionalities. These libraries or apps are listed in separate repo with proprietary files.<li>In order to generate this repository, we extract the required proprietary libraries or apps from stock OEM firmware using <em>proprietary extract scripts</em>. These scripts are present in ROM side in certain ROMs which can be picked up from basic scripts which we set in our device trees, and which define certain variables and helps in generating a <code class="language-plaintext highlighter-rouge">Makefile</code> to ease our work and just call the repo in order to get started.<li>At first you can pick these device-side shell scripts from <a href="https://github.com/danascape/device_asus_X01AD/commit/08b2897c33ed5cf7fd18198b30752f6">here</a> and modify them based on your device product name and manufacturer.<li>Before running your shell scripts create a proprietary files list as per your device called <code class="language-plaintext highlighter-rouge">proprietary-files.txt</code> this way: ```txt<h1 id="ant">ANT</h1><p>-lib/libantradio.so -lib64/libantradio.so product/lib/com.qualcomm.qti.ant@1.0.so product/lib64/com.qualcomm.qti.ant@1.0.so</p></ul><h1 id="alarm">Alarm</h1><p>product/framework/vendor.qti.hardware.alarm-V1.0-java.jar</p><h1 id="audio">Audio</h1><p>etc/permissions/audiosphere.xml framework/audiosphere.jar ``` This is a section of my current proprietary list and it can be different for other devices. You can find my full system-side listing <a href="https://github.com/danascape/device_asus_X01AD/blob/lineage-17.1-preb/proprietary-files.txt">here</a>.</p><ul><li>Now, hoping that your list is created and all went well, in order to run <code class="language-plaintext highlighter-rouge">extract-files.sh</code>, you need <code class="language-plaintext highlighter-rouge">adb</code> support on your system or device dump where you can point out script to extract. You can read these scripts in order to check how they work and extract.<li>After you run these scripts, it will extract the apps and libs listed in your proprietary files and will setup makefiles in a separate directory which can be called as listed above in BoardConfig and device makefile section.</ul><h2 id="getting-things-running"><span class="me-2">Getting things running</span><a href="#getting-things-running" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>If all above goes well, you can go to your ROM source directory and <code class="language-plaintext highlighter-rouge">lunch</code> the device product (I will not explain how to start build as its a basic requirement to know how to build a ROM before you do a bringup).<li>Start your build and let it complete. These are only basic requirements for a device to get built and booting it is a different thing. Sometimes your ROM might get stuck on logo or stuck on endless boot animation, you will need to debug these issues in order to get things running.<li>I will list up some reference system-only device trees that you can learn from.</ul><p><a href="https://github.com/danascape/device_asus_X01AD/tree/lineage-17.1-preb">danascape/device_asus_X01AD</a></p><p><a href="https://github.com/danascape/device_oneplus_billie/tree/lineage-17.1-prebuilt">danascape/device_oneplus_billie</a></p><p><a href="https://github.com/danascape/device_xiaomi_olive/tree/lineage-17.1-preb">danascape/device_xiaomi_olive</a></p><p><a href="https://github.com/danascape/device_xiaomi_violet/tree/lineage-17.1-prebuilt">danascape/device_xiaomi_violet</a></p><ul><li>Certain device might need more things in order to get booting. These things might include AB or dynamic partition based BoardConfig flags, boot control HAL or gpt-utils or some extra libs. You can check more about how I did these things in above references.</ul><p>Let me know your new experiences at my <a href="mail:danascape@gmail.com">email</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/aosp/">AOSP</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/aosp/" class="post-tag no-text-decoration" >AOSP</a> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Android%20Device%20Tree%20Bringup%20-%20squadri&url=https%3A%2F%2Fdanascape.github.io%2Fposts%2FAndroid-Device-Tree-Bringup%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Android%20Device%20Tree%20Bringup%20-%20squadri&u=https%3A%2F%2Fdanascape.github.io%2Fposts%2FAndroid-Device-Tree-Bringup%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fdanascape.github.io%2Fposts%2FAndroid-Device-Tree-Bringup%2F&text=Android%20Device%20Tree%20Bringup%20-%20squadri" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/GSoC-2025-week1-2/">GSoC 2025 - Week 1,2 - Setting Up the Build</a><li class="text-truncate lh-lg"> <a href="/posts/GSoC-2025-week3/">GSoC 2025 - Week 3 - Starting to Code</a><li class="text-truncate lh-lg"> <a href="/posts/GSoC-2025-week4/">GSoC 2025 - Week 4 - First Patch to Gerrit</a><li class="text-truncate lh-lg"> <a href="/posts/GSoC-2025-week5/">GSoC 2025 - Week 5 - Testing the patchset</a><li class="text-truncate lh-lg"> <a href="/posts/GSoC-2025-week6/">GSoC 2025 - Week 6 - Final Build Patchset</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/lfx/">LFX</a> <a class="post-tag btn btn-outline-primary" href="/tags/agl/">AGL</a> <a class="post-tag btn btn-outline-primary" href="/tags/gsoc/">GSoC</a> <a class="post-tag btn btn-outline-primary" href="/tags/lf/">LF</a> <a class="post-tag btn btn-outline-primary" href="/tags/raspberrypi/">RaspberryPI</a> <a class="post-tag btn btn-outline-primary" href="/tags/yocto/">Yocto</a> <a class="post-tag btn btn-outline-primary" href="/tags/android/">Android</a> <a class="post-tag btn btn-outline-primary" href="/tags/aosp/">AOSP</a> <a class="post-tag btn btn-outline-primary" href="/tags/kernel/">Kernel</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux-kernel/">Linux Kernel</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Features-and-Future-Scope-in-AOSP-Part-2/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1753122600" data-df="ll" > Jul 22, 2025 </time><h4 class="pt-0 my-2">Features and Future Scope in AOSP - Part 2</h4><div class="text-muted"><p>***Something that started as a hobby of mine, to something that I do professionally in my daily life.*** ## Core Features * Modular Architecture * Dynamic partitions for seamless A/B updates (...</p></div></div></a></article><article class="col"> <a href="/posts/Getting-Started-with-AOSP-Part-1/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1752517800" data-df="ll" > Jul 15, 2025 </time><h4 class="pt-0 my-2">Getting Started with AOSP - Part 1</h4><div class="text-muted"><p>![](/assets/images/posts/AOSP-Tutorial/android.png) Today marks six years since I compiled my very first Android source build — it was Android 7.0 Nougat. Ever since then, I’ve been deeply involve...</p></div></div></a></article><article class="col"> <a href="/posts/Introduction-to-AOSP/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1667673000" data-df="ll" > Nov 6, 2022 </time><h4 class="pt-0 my-2">Introduction to AOSP</h4><div class="text-muted"><p>The Android Open Source Project is an open source development project managed by Google, and anyone is welcome to evaluate and add code and fixes to the source code. ![Photo by Marek Piwnicki / Un...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Writing-an-Overlayed-DTS/" class="btn btn-outline-primary" aria-label="Older" ><p>Writing an Overlayed DTS</p></a> <a href="/posts/Introduction-to-AOSP/" class="btn btn-outline-primary" aria-label="Newer" ><p>Introduction to AOSP</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://x.com/danascape">Saalim Quadri</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/lfx/">LFX</a> <a class="post-tag btn btn-outline-primary" href="/tags/agl/">AGL</a> <a class="post-tag btn btn-outline-primary" href="/tags/gsoc/">GSoC</a> <a class="post-tag btn btn-outline-primary" href="/tags/lf/">LF</a> <a class="post-tag btn btn-outline-primary" href="/tags/raspberrypi/">RaspberryPI</a> <a class="post-tag btn btn-outline-primary" href="/tags/yocto/">Yocto</a> <a class="post-tag btn btn-outline-primary" href="/tags/android/">Android</a> <a class="post-tag btn btn-outline-primary" href="/tags/aosp/">AOSP</a> <a class="post-tag btn btn-outline-primary" href="/tags/kernel/">Kernel</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux-kernel/">Linux Kernel</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> var disqus_config = function () { this.page.url = 'https://danascape.github.io/posts/Android-Device-Tree-Bringup/'; this.page.identifier = '/posts/Android-Device-Tree-Bringup/'; }; function addDisqus() { let disqusThread = document.createElement('div'); let paragraph = document.createElement('p'); disqusThread.id = 'disqus_thread'; paragraph.className = 'text-center text-muted small'; paragraph.innerHTML = 'Comments powered by <a href="https://disqus.com/">Disqus</a>.'; disqusThread.appendChild(paragraph); const footer = document.querySelector('footer'); footer.insertAdjacentElement("beforebegin", disqusThread); }function reloadDisqus(event) { if (event.source === window && event.data && event.data.id === Theme.ID) {if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } addDisqus(); if (Theme.switchable) { addEventListener('message', reloadDisqus); }var disqusObserver = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { var d = document, s = d.createElement('script'); s.src = 'https://squadri.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); disqusObserver.disconnect(); } }, { threshold: [0] } ); disqusObserver.observe(document.getElementById('disqus_thread')); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
